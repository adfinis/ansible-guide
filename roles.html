<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Roles &mdash; Ansible Guide</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/adsy.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="_static/documentation_options.js?v=f2a433a1"></script>
        <script src="_static/doctools.js?v=888ff710"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Role Overview" href="role_overview.html" />
    <link rel="prev" title="Styling Guide" href="styling_guide.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            Ansible Guide
          </a>
              <div class="version">
                1.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="styling_guide.html">Styling Guide</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Roles</a></li>
<li class="toctree-l1"><a class="reference internal" href="role_overview.html">Role Overview</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Ansible Guide</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Roles</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/roles.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="roles">
<h1>Roles<a class="headerlink" href="#roles" title="Link to this heading"></a></h1>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>.
├── defaults/
│   └── main.yml
├── files/
│   └── etc/
│       └── default/
│           └── ssh
├── handlers/
│   └── main.yml
├── meta/
│   └── main.yml
├── tasks/
│   ├── configuration.yml
│   ├── installation.yml
│   └── main.yml
├── templates/
│   └── etc/
│       └── ssh/
│           └── sshd_config.j2
└── vars/
     ├── Debian.yml
     └── RedHat.yml
</pre></div>
</div>
<section id="tasks">
<h2>Tasks<a class="headerlink" href="#tasks" title="Link to this heading"></a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">main.yml</span></code> file is just used to include the other yaml files.</p>
<div class="highlight-Yaml notranslate"><div class="highlight"><pre><span></span><span class="nn">---</span>

<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">include os specific vars</span>
<span class="w">  </span><span class="nt">include_vars</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">item</span><span class="nv"> </span><span class="s">}}&#39;</span>
<span class="w">  </span><span class="nt">with_first_found</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">ansible_distribution</span><span class="nv"> </span><span class="s">}}_{{</span><span class="nv"> </span><span class="s">ansible_distribution_major_version</span><span class="nv"> </span><span class="s">}}.yml&#39;</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">ansible_os_family</span><span class="nv"> </span><span class="s">}}.yml&#39;</span>
<span class="w">  </span><span class="nt">tags</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;role::$ROLENAME&#39;</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;role::$ROLENAME:install&#39;</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;role::$ROLENAME:config&#39;</span>

<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">import_tasks</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">installation.yml</span>
<span class="w">  </span><span class="nt">tags</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;role::$ROLENAME&#39;</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;role::$ROLENAME:install&#39;</span>

<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">import_tasks</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">configuration.yml</span>
<span class="w">  </span><span class="nt">tags</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;role::$ROLENAME&#39;</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;role::$ROLENAME:config&#39;</span>
</pre></div>
</div>
<p>Role tagging helps later while running Ansible. If <code class="docutils literal notranslate"><span class="pre">ansible-playbook</span></code> is
called with tags, only matching tasks, else all, will be executed.</p>
<p>Tasks inside the <code class="docutils literal notranslate"><span class="pre">installation.yml</span></code> file are to install all related
packages. The related packages are stored as a variable.</p>
<div class="highlight-Yaml notranslate"><div class="highlight"><pre><span></span><span class="nn">---</span>

<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">install ssh related packages</span>
<span class="w">  </span><span class="nt">package</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">ssh_packages</span><span class="nv"> </span><span class="s">}}&#39;</span>
<span class="w">    </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
</pre></div>
</div>
<p>Inside <code class="docutils literal notranslate"><span class="pre">configuration.yml</span></code> all configurations can be modified.</p>
<div class="highlight-Yaml notranslate" id="configure-ssh"><div class="highlight"><pre><span></span><span class="nn">---</span>

<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">create ssh authorized keys directory</span>
<span class="w">  </span><span class="nt">file</span><span class="p">:</span>
<span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/ssh/authorized_keys</span>
<span class="w">    </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">directory</span>
<span class="w">    </span><span class="nt">owner</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">root</span>
<span class="w">    </span><span class="nt">group</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">root</span>
<span class="w">    </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0755</span>
<span class="w">    </span><span class="nt">seuser</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">system_u</span>
<span class="w">    </span><span class="nt">serole</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">object_r</span>
<span class="w">    </span><span class="nt">setype</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sshd_key_t</span>
<span class="w">    </span><span class="nt">selevel</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">s0</span>

<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">configure ssh</span>
<span class="w">  </span><span class="nt">template</span><span class="p">:</span>
<span class="w">    </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">etc/ssh/sshd_config.j2</span>
<span class="w">    </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">ssh_daemon_cfg</span><span class="nv"> </span><span class="s">}}&#39;</span>
<span class="w">    </span><span class="nt">owner</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">root</span>
<span class="w">    </span><span class="nt">group</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">root</span>
<span class="w">    </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0644</span>
<span class="w">    </span><span class="nt">seuser</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">system_u</span>
<span class="w">    </span><span class="nt">serole</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">object_r</span>
<span class="w">    </span><span class="nt">setype</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">etc_t</span>
<span class="w">    </span><span class="nt">selevel</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">s0</span>
<span class="w">  </span><span class="nt">notify</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;ssh</span><span class="nv"> </span><span class="s">check</span><span class="nv"> </span><span class="s">sshd</span><span class="nv"> </span><span class="s">config</span><span class="nv"> </span><span class="s">and</span><span class="nv"> </span><span class="s">restart&#39;</span>
</pre></div>
</div>
<p>Add additional tags to installation and configuration tasks if needed, but
be aware to add also the base tags like in the <code class="docutils literal notranslate"><span class="pre">main.yml</span></code>.</p>
<p>Good example:</p>
<div class="highlight-Yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">install ssh related packages</span>
<span class="w">  </span><span class="nt">package</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">ssh_packages</span><span class="nv"> </span><span class="s">}}&#39;</span>
<span class="w">    </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
<span class="w">  </span><span class="nt">tags</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;role::$ROLENAME&#39;</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;role::$ROLENAME:install&#39;</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;role::$ROLENAME:packages&#39;</span>
</pre></div>
</div>
<p>Bad example:</p>
<div class="highlight-Yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">install ssh related packages</span>
<span class="w">  </span><span class="nt">package</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">ssh_packages</span><span class="nv"> </span><span class="s">}}&#39;</span>
<span class="w">    </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
<span class="w">  </span><span class="nt">tags</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;role::$ROLENAME:packages&#39;</span>
</pre></div>
</div>
</section>
<section id="variables">
<h2>Variables<a class="headerlink" href="#variables" title="Link to this heading"></a></h2>
<p>Variables are used for static data, e.g. package, service and filenames.
Don’t use variables for data which can change, for that use the defaults!</p>
<p>In the directory <code class="docutils literal notranslate"><span class="pre">vars/</span></code> are required at least the files</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Debian.yml</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">RedHat.yml</span></code></p></li>
</ul>
<p>If there are special variables for some operating systems, you can specify
those in the files named:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Debian_7.yml</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Debian_8.yml</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CentOS_6.yml</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CentOS_7.yml</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Ubuntu_14.yml</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Ubuntu_16.yml</span></code></p></li>
<li><p>…</p></li>
</ul>
<p>Each variable start with <code class="docutils literal notranslate"><span class="pre">&lt;rolename&gt;_</span></code> and the name contains only lower
case, numbers and underline <code class="docutils literal notranslate"><span class="pre">_</span></code>.
<strong>A comment before the variable is required!</strong></p>
<div class="highlight-Yaml notranslate"><div class="highlight"><pre><span></span><span class="nn">---</span>

<span class="c1"># ssh related packages</span>
<span class="nt">ssh_packages</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">openssh-client</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">openssh-server</span>

<span class="c1"># ssh service name</span>
<span class="nt">ssh_service</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ssh</span>

<span class="c1"># ssh daemon binary (absolute path)</span>
<span class="nt">ssh_daemon_bin</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/usr/sbin/sshd</span>

<span class="c1"># ssh daemon configuration file</span>
<span class="nt">ssh_daemon_cfg</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/ssh/sshd_config</span>

<span class="c1"># ssh daemon sftp server</span>
<span class="nt">ssh_sftp_server</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/usr/lib/openssh/sftp-server</span>
</pre></div>
</div>
</section>
<section id="defaults">
<h2>Defaults<a class="headerlink" href="#defaults" title="Link to this heading"></a></h2>
<p>Every variable which is used inside a template or for tasks, and which is
not defined in the vars, needs to be defined as defaults.
Defaults can be used for example for cipher suites, ntp server names or
default ports.
<strong>A comment before the variable is required!</strong></p>
<p>There is only one defaults file, called <code class="docutils literal notranslate"><span class="pre">main.yml</span></code>.</p>
<div class="highlight-Yaml notranslate"><div class="highlight"><pre><span></span><span class="nn">---</span>

<span class="c1"># a list of ssh host keys</span>
<span class="nt">ssh_host_keys</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/ssh/ssh_host_rsa_key</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/ssh/ssh_host_ed25519_key</span>
</pre></div>
</div>
</section>
<section id="handlers">
<h2>Handlers<a class="headerlink" href="#handlers" title="Link to this heading"></a></h2>
<p>Handlers are used to check configurations and restart services. Don’t
restart a service with a task, as it’s run every time the role is running.
The advantage of handlers is, that they must be notified by a task or even
multiple tasks, and they run only once per playbook.
Use handlers instead of a check when a previous task has changed.</p>
<div class="highlight-Yaml notranslate"><div class="highlight"><pre><span></span><span class="nn">---</span>

<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ssh check sshd config and restart</span>
<span class="w">  </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">ssh_daemon_bin</span><span class="nv"> </span><span class="s">}}</span><span class="nv"> </span><span class="s">-t&#39;</span>
<span class="w">  </span><span class="nt">notify</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;ssh</span><span class="nv"> </span><span class="s">restart</span><span class="nv"> </span><span class="s">sshd&#39;</span>

<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ssh restart sshd</span>
<span class="w">  </span><span class="nt">service</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">ssh_service</span><span class="nv"> </span><span class="s">}}&#39;</span>
<span class="w">    </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">restarted</span>
</pre></div>
</div>
<p>This handler gets notified by a task called <a class="reference internal" href="#configure-ssh">configure ssh</a> it will call the
handler <code class="docutils literal notranslate"><span class="pre">check</span> <span class="pre">sshd</span> <span class="pre">config</span> <span class="pre">and</span> <span class="pre">restart</span></code>, but only if the task has
effected a change.</p>
</section>
<section id="files">
<h2>Files<a class="headerlink" href="#files" title="Link to this heading"></a></h2>
<p>If some static files have to be copied, they can be stored
in the directory <code class="docutils literal notranslate"><span class="pre">files</span></code>. Files are rarely used, they are mostly replaced
with templates. E.g. a binary or a compressed file can be copied with file.</p>
<p>Within this directory, we rebuild the path structure of a target system. We
do not store files in a flattened directory.</p>
<p>Good example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>ssh/
└── files/
    └── etc/
        ├── default/
        │   └── ssh
        └── ssh/
            └── ssh_config
</pre></div>
</div>
<p>Bad example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>ssh/
└── files/
    ├── ssh
    └── ssh_config
</pre></div>
</div>
</section>
<section id="meta">
<h2>Meta<a class="headerlink" href="#meta" title="Link to this heading"></a></h2>
<p>Meta information of a role are defined here. I.e. requirements for a role.</p>
<div class="highlight-Yaml notranslate"><div class="highlight"><pre><span></span><span class="nn">---</span>

<span class="nt">dependencies</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">role</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pki</span>

<span class="nt">galaxy_info</span><span class="p">:</span>
<span class="w">  </span><span class="nt">author</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;Adfinis</span><span class="nv"> </span><span class="s">AG&#39;</span>
<span class="w">  </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;Install</span><span class="nv"> </span><span class="s">and</span><span class="nv"> </span><span class="s">manage</span><span class="nv"> </span><span class="s">ssh</span><span class="nv"> </span><span class="s">and</span><span class="nv"> </span><span class="s">sshd&#39;</span>
<span class="w">  </span><span class="nt">company</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;Adfinis</span><span class="nv"> </span><span class="s">AG&#39;</span>
<span class="w">  </span><span class="nt">license</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;GNU</span><span class="nv"> </span><span class="s">General</span><span class="nv"> </span><span class="s">Public</span><span class="nv"> </span><span class="s">License</span><span class="nv"> </span><span class="s">v3&#39;</span>
<span class="w">  </span><span class="nt">min_ansible_version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;2.0.0&#39;</span>
<span class="w">  </span><span class="nt">platforms</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Archlinux</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Debian</span>
<span class="w">      </span><span class="nt">versions</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">wheezy</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">jessie</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">stretch</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Ubuntu</span>
<span class="w">      </span><span class="nt">versions</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">trusty</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">xenial</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CentOS</span>
<span class="w">      </span><span class="nt">versions</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">7</span>
<span class="w">  </span><span class="nt">galaxy_tags</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ssh</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sshd</span>
</pre></div>
</div>
</section>
<section id="templates">
<h2>Templates<a class="headerlink" href="#templates" title="Link to this heading"></a></h2>
<p>Within this directory, template files are stored with a <cite>.j2</cite> extension as the
files are threatend as <a class="reference external" href="http://jinja.pocoo.org/">Jinja2</a> templates. This
allows to customize files.
Templates should have a comment with <code class="docutils literal notranslate"><span class="pre">{{</span> <span class="pre">ansible_managed</span> <span class="pre">}}</span></code> as the very
beginning. This generates a comment header inside the file, warning a
potential user that changes to the file may be overwritten.</p>
<p>If possible validate the template before copying it into place. This will
guarantee that configuration will work after restarting the corresponding
service.</p>
<p>Good example:</p>
<div class="highlight-Yaml notranslate"><div class="highlight"><pre><span></span><span class="nn">---</span>

<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">configure the ssh daemon</span>
<span class="w">  </span><span class="nt">template</span><span class="p">:</span>
<span class="w">    </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">etc/ssh/sshd_config.j2</span>
<span class="w">    </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">ssh_daemon_cfg</span><span class="nv"> </span><span class="s">}}&#39;</span>
<span class="w">    </span><span class="nt">owner</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">root</span>
<span class="w">    </span><span class="nt">group</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">root</span>
<span class="w">    </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0644</span>
<span class="w">    </span><span class="nt">seuser</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">system_u</span>
<span class="w">    </span><span class="nt">serole</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">object_r</span>
<span class="w">    </span><span class="nt">setype</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">etc_t</span>
<span class="w">    </span><span class="nt">selevel</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">s0</span>
<span class="w">    </span><span class="nt">validate</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">ssh_daemon_bin</span><span class="nv"> </span><span class="s">}}</span><span class="nv"> </span><span class="s">-t</span><span class="nv"> </span><span class="s">-f</span><span class="nv"> </span><span class="s">%s&#39;</span>
<span class="w">  </span><span class="nt">notify</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;ssh</span><span class="nv"> </span><span class="s">restart</span><span class="nv"> </span><span class="s">sshd&#39;</span>
</pre></div>
</div>
<p>If not a single configuration file is used and it isn’t possible to validate
the configuration file, then do it with a handler which checks the
configuration before calling another handler which will restart the service.</p>
<p>Within this directory, we rebuild the path structure of a target system. We
do not store templates in a flattened directory.</p>
<p>Good example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>ssh/
└── templates/
    └── etc/
        ├── default/
        │   └── ssh.j2
        └── ssh/
            └── ssh_config.j2
</pre></div>
</div>
<p>Bad example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>ssh/
└── templates/
    ├── ssh.j2
    └── ssh_config.j2
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="styling_guide.html" class="btn btn-neutral float-left" title="Styling Guide" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="role_overview.html" class="btn btn-neutral float-right" title="Role Overview" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright Adfinis AG.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>